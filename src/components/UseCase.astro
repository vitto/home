---
import Button from './Button.astro';
import Icon from './Icon.astro';

interface Props {
  title?: string;
  description?: string;
  id?: string;
  class?: string;
}

const { title, description, id, class: className = '' } = Astro.props;

// Generate id from title: lowercase, replace spaces with hyphens, remove special characters
// If no title, generate a unique ID
const articleId = title
  ? title
      .toLowerCase()
      .replace(/[^a-z0-9]+/g, '-')
      .replace(/^-+|-+$/g, '')
  : `use-case-${crypto.randomUUID().split('-')[0]}`;
---

{
  title ? (
    <article id={id || articleId} class={`use-case grid gap-600 scroll-m-1000 ${className}`}>
      <div class="flex items-start gap-200 justify-between">
        <div class="grid gap-200">
          <h3 class="text-title-h3">{title}</h3>
          <p class="text-info-detail">{description}</p>
        </div>
        <Button
          data-copy-link
          data-article-id={articleId}
          variant="light"
          class="shrink-0 py-300 -mb-400"
          title={`Copy link to ${title}`}
        >
          <Icon name="mi/baseline/link" class="text-tone-neutral-04" />
        </Button>
      </div>
      <slot />
    </article>
  ) : (
    <div id={id || articleId} class={`use-case grid gap-600 scroll-m-1000 ${className}`}>
      <slot />
    </div>
  )
}

<script define:vars={{ articleId, id }}>
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      window.initUseCaseCLS(id || articleId);
    });
  } else {
    window.initUseCaseCLS(id || articleId);
  }
</script>
