---
import Button from './Button.astro';
import Icon from './Icon.astro';

interface Props {
  title: string;
  description: string;
  class?: string;
}

const { title, description, class: className = '' } = Astro.props;

// Generate id from title: lowercase, replace spaces with hyphens, remove special characters
const articleId = title
  .toLowerCase()
  .replace(/[^a-z0-9]+/g, '-')
  .replace(/^-+|-+$/g, '');
---

<article id={articleId} class={`grid gap-600 scroll-m-1000 ${className}`}>
  <div class="flex items-start gap-200 justify-between">
    <div class="grid gap-200">
      <h3 class="text-title-h3">{title}</h3>
      <p class="text-info-detail">{description}</p>
    </div>
    <Button
      data-copy-link
      data-article-id={articleId}
      variant="light"
      class="shrink-0 py-300 -mb-400"
      title={`Copy link to ${title}`}
    >
      <Icon name="mi/baseline/link" class="text-tone-neutral-04" />
    </Button>
  </div>
  <slot />
</article>

<script define:vars={{ articleId }}>
  function initUseCaseCLS() {
    // Get the scope for this use case using the article ID
    const scope = window.getUseCaseScope?.(articleId);
    if (!scope || !scope.container) return;

    // Initialize CLS prevention and viewport opacity for this use case
    if (window.removeCLSPreventStyle) {
      setTimeout(() => {
        window.removeCLSPreventStyle(scope.container);
      }, 100);
      // Also try after a longer delay as fallback
      setTimeout(() => {
        window.removeCLSPreventStyle(scope.container);
      }, 1000);
    }

    if (window.initViewportOpacity) {
      window.initViewportOpacity(scope.container);
    }
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      initUseCaseCLS();
    });
  } else {
    initUseCaseCLS();
  }
</script>
