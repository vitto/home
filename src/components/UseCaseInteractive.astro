---
/**
 * UseCaseInteractive Component
 *
 * Wrapper for interactive use case demonstrations
 * Provides a container with appropriate styling for custom interactive content
 *
 * Props:
 * @param {string} class - Additional CSS classes
 */
interface Props {
  class?: string;
  contentClass?: string;
  label?: string;
  clsHeight?: number;
  toggle?: boolean;
  size?: 'sm' | 'md';
  transparent?: boolean;
  padding?: boolean;
  multiple?: boolean;
  overflowHidden?: boolean;
  articleId?: string;
  bugExpected?: string;
  bugCurrent?: string;
  bugComponent?: string;
}

const {
  class: className = '',
  contentClass = 'justify-center items-center gap-400',
  clsHeight = null,
  label = null,
  toggle = false,
  multiple = false,
  transparent = false,
  size = 'md',
  padding = true,
  overflowHidden = true,
  articleId = null,
  bugExpected = null,
  bugCurrent = null,
  bugComponent = null,
} = Astro.props;

// Validate that toggle and multiple are mutually exclusive
if (toggle && multiple) {
  throw new Error(
    'UseCaseInteractive: `toggle` and `multiple` props cannot be used together. Please use only one of them.'
  );
}

const initialStyle = clsHeight ? `max-height: ${clsHeight}px; min-height: ${clsHeight}px;` : null;
---

<div
  class={`use-case-interactive bg-tone-neutral-10 dark:bg-tone-neutral-09 p-600 mobile:px-300 ${bugExpected || bugCurrent ? 'pt-200 gap-200' : 'pt-400 gap-400'} grid grid-cols-full tablet:rounded-[28px] mobile:-mx-600 group z-10 ${className}`}
>
  <div class="flex justify-center items-center gap-100">
    {
      multiple && (
        <>
          <div
            class="inline-flex justify-self-center items-center justify-center min-h-400"
            data-multiple-indicators
          >
            {/* Indicators will be dynamically generated by JavaScript */}
          </div>
          <template data-multiple-indicator-template>
            <a
              class="size-200 rounded-full focus-bounce relative focus-visible:z-10 cursor-pointer bg-tone-neutral-07"
              tabindex="0"
              data-multiple-index
            />
          </template>
        </>
      )
    }
    {
      toggle ? (
        <div class="inline-flex items-center gap-200 text-tone-neutral-04 justify-self-center min-h-600">
          <mds-text class="cursor-default" typography="option">
            off
          </mds-text>
          <mds-input-switch size="sm" typography="option" explicit data-toggle-switch checked />
          <mds-text class="cursor-default" typography="option">
            on
          </mds-text>
        </div>
      ) : !multiple ? (
        <p
          class={`${label ? 'group-hover:blink' : ''} text-info-option text-center text-tone-neutral-03 justify-self-center`}
        >
          {label || 'Use case'}
        </p>
      ) : null
    }
    {
      (bugExpected || bugCurrent) && articleId ? (
        <>
          <mds-button
            icon="mi/outline/bug-report"
            variant="error"
            tone="quiet"
            class="bug-report min-h-900"
            title="Show bug report details"
          />
          <mds-dropdown class="max-w-8000" target={`#${articleId} .bug-report`}>
            <div class="flex justify-between items-center gap-200">
              <mds-badge variant="error">Bug report</mds-badge>
            </div>
            {bugCurrent && (
              <div class="grid gap-100">
                <mds-text typography="h6">Current behavior</mds-text>
                <mds-text typography="caption">{bugCurrent}</mds-text>
              </div>
            )}
            {bugExpected && (
              <div class="grid gap-100">
                <mds-text typography="h6">Expected behavior</mds-text>
                <mds-text typography="caption">{bugExpected}</mds-text>
              </div>
            )}
            <div class="px-600 py-400 -mx-600 -mb-600 bg-tone-neutral-10 rounded-b-lg">
              {bugComponent ? (
                <div class="grid gap-200">
                  <mds-text typography="option">Component affected</mds-text>
                  <mds-badge
                    variant="light"
                    tone="strong"
                    class="justify-self-start bg-tone-neutral shadow-outline-light"
                  >
                    {bugComponent}
                  </mds-badge>
                </div>
              ) : (
                <mds-text typography="caption">I'll fix this issue as soon as possible</mds-text>
              )}
            </div>
          </mds-dropdown>
        </>
      ) : null
    }
  </div>
  <div
    class={`flex flex-col items-center justify-center gap-400 ${transparent ? '' : 'bg-tone-neutral shadow-sm-sharp'} ${overflowHidden ? 'overflow-hidden' : ''} ${padding ? 'p-600 mobile:px-300' : ''} rounded-xl dark:border-solid dark:border-tone-neutral-07 dark:border w-full ${size === 'md' ? 'tablet:py-1200' : ''}`}
  >
    <div
      class={`use-case-interactive-content flex flex-col transition-cosmetic w-full relative box-border delay-300 opacity-0 scale-90 ${contentClass}`}
      style={initialStyle}
      hidden
      data-cls-prevent
      data-toggle-container={toggle ? 'true' : undefined}
      data-multiple-container={multiple ? 'true' : undefined}
      lang="en"
    >
      <slot />
    </div>
  </div>
</div>

<script define:vars={{ articleId, multiple }}>
  if (window.initToggle && articleId && !multiple) {
    window.initToggle(articleId);
  }
  if (window.initMultiple && articleId && multiple) {
    window.initMultiple(articleId);
  }
</script>
