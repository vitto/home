---
/**
 * AIFilePreview Component
 *
 * File preview with AI confidence level, classification summary, and document extract.
 * Variants: high, medium, low confidence.
 *
 * Props:
 * @param {string} filename - File name
 * @param {string} filesize - File size (display string or number)
 * @param {'high' | 'medium' | 'low'} confidence - Confidence level
 * @param {string} classification - Short classification summary (e.g. "This document appears to be a contract...")
 * @param {string} extract - Extract from the document
 * @param {string} class - Additional CSS classes
 */
interface Props {
  filename: string;
  filesize: string;
  confidence: 'high' | 'medium' | 'low';
  classification: string;
  extract: string;
  class?: string;
}

const {
  filename,
  filesize,
  confidence,
  classification,
  extract,
  class: className = '',
} = Astro.props;

const confidenceConfig = {
  high: {
    variant: 'success' as const,
    icon: 'mi/baseline/check-circle',
    iconColor: 'fill-status-success-05',
    bannerColor: 'bg-status-success-10',
    value: 92,
    alias: 'High',
    message: 'High confidence',
  },
  medium: {
    variant: 'warning' as const,
    icon: 'mi/outline/warning',
    iconColor: 'fill-status-warning-05',
    bannerColor: 'bg-status-warning-10',
    value: 65,
    alias: 'Medium',
    message: 'Medium confidence',
  },
  low: {
    variant: 'error' as const,
    icon: 'mi/outline/error',
    iconColor: 'fill-status-error-05',
    bannerColor: 'bg-status-error-10',
    value: 45,
    alias: 'Low',
    message: 'Low confidence',
  },
};

const config = confidenceConfig[confidence];
---

<div
  class={`grid grid-cols-full auto-cols-min gap-600 m-auto max-w-6400 ${className}`}
  data-ai-file-preview
>
  <mds-file-preview class="self-start" filename={filename} filesize={filesize}></mds-file-preview>
  <div class="grid gap-400 grid-cols-full">
    <mds-text typography="detail">
      {extract}
    </mds-text>
    <div
      class={`rounded-2xl p-400 ${config.bannerColor} grid cursor-pointer focus-bounce select-none`}
      data-confidence-banner
      role="button"
      tabindex="0"
      aria-expanded="true"
      aria-label="Toggle confidence details"
    >
      <div class="confidence-banner__row" data-confidence-icon>
        <div class="confidence-banner__row-inner flex">
          <div class="flex pb-200">
            <mds-icon
              class={`size-600 shrink-0 transition-transform ${config.iconColor}`}
              name={config.icon}></mds-icon>
          </div>
        </div>
      </div>
      <mds-benchmark-bar class="grow min-h-0 shrink-0" value={config.value} variant={config.variant}
        >{config.message}</mds-benchmark-bar
      >
      <div class="confidence-banner__row" data-confidence-message>
        <div class="confidence-banner__row-inner flex overflow-hidden">
          <mds-text typography="caption" class="pt-200">{classification}</mds-text>
        </div>
      </div>
    </div>

    <div class="flex items-end justify-self-start">
      <mds-button variant="dark" tone="ghost" size="sm">View document</mds-button>
    </div>
  </div>
  <style>
    .confidence-banner__row {
      display: grid;
      grid-template-rows: 0fr;
      transition: grid-template-rows 0.25s ease;
    }
    [data-confidence-banner][data-opened] .confidence-banner__row {
      grid-template-rows: 1fr;
    }

    [data-confidence-banner] mds-icon {
      transform: scale(0);
    }

    [data-confidence-banner][data-opened] mds-icon {
      transform: scale(1);
    }

    .confidence-banner__row-inner {
      min-height: 0;
    }
  </style>
  <script>
    document.querySelectorAll('[data-confidence-banner]').forEach((banner) => {
      banner.addEventListener('click', () => {
        const opened = banner.hasAttribute('data-opened');
        if (opened) {
          banner.removeAttribute('data-opened');
          banner.setAttribute('aria-expanded', 'false');
        } else {
          banner.setAttribute('data-opened', '');
          banner.setAttribute('aria-expanded', 'true');
        }
      });
      banner.addEventListener('keydown', (e: Event) => {
        const ke = e as KeyboardEvent;
        if (ke.key === 'Enter' || ke.key === ' ') {
          e.preventDefault();
          (banner as HTMLElement).click();
        }
      });
    });
  </script>
</div>
