---
import Usage from '../../../Usage.astro';
import UsageItem from '../../../UsageItem.astro';
import UseCase from '../../../UseCase.astro';
import UseCaseInteractive from '../../../UseCaseInteractive.astro';
---

<UseCase
  title="User Actions"
  description="Every input produces immediate and perceptible feedback, so the user knows the action has been received and is being processed or completed."
>
  <UseCaseInteractive clsHeight={36} label="A button to save an element">
    <mds-button class="max-w-8000 w-full" data-save-button>Save</mds-button>
    <script>
      function initSaveButton() {
        // Get the UseCase scope (article and container) for this script
        const scope = (window as any).getUseCaseScope?.('user-actions');
        if (!scope) return;

        const { container } = scope;

        // Scope query to the container
        const saveButton = container.querySelector('[data-save-button]');
        if (!saveButton) return;

        let isProcessing = false;

        saveButton.addEventListener('click', () => {
          // Prevent multiple clicks while processing
          if (isProcessing) return;

          isProcessing = true;
          saveButton.textContent = 'Element saved successfully';
          saveButton.classList.add('pointer-events-none');
          saveButton.setAttribute('tabindex', '-1');
          saveButton.blur();
          saveButton.setAttribute('icon', 'mi/baseline/done');
          saveButton.setAttribute('variant', 'success');

          setTimeout(() => {
            saveButton.textContent = 'Save';
            saveButton.classList.remove('pointer-events-none');
            saveButton.removeAttribute('icon');
            saveButton.setAttribute('tabindex', '0');
            saveButton.setAttribute('variant', 'primary');
            isProcessing = false;
          }, 2000);
        });
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initSaveButton);
      } else {
        initSaveButton();
      }
    </script>
  </UseCaseInteractive>
  <Usage>
    <UsageItem variant="do">Provide instant visual feedback for every interaction</UsageItem>
    <UsageItem variant="dont">Require users to infer whether an action was registered</UsageItem>
    <UsageItem variant="do">Disable controls while an action is processing</UsageItem>
    <UsageItem variant="dont">Allow repeated clicks that trigger duplicate actions</UsageItem>
    <UsageItem variant="do">Confirm completion with clear feedback</UsageItem>
    <UsageItem variant="dont">Rely only on subtle or invisible state changes</UsageItem>
  </Usage>
</UseCase>
