---
import Icon from './Icon.astro';

/**
 * Button Component
 *
 * Renders a button/link with consistent styling and security attributes
 *
 * Props:
 * @param {string} href - Link URL (if not provided, renders as button element)
 * @param {string} class - Additional CSS classes to add (base "button" class is always included)
 * @param {string} icon - Custom icon
 * @param {number} tabIndex - Tab index for the button
 * @param {string} variant - Button variant (e.g., "outline", "light", "hero", or color variants)
 */
interface Props {
  href?: string;
  class?: string;
  icon?: string;
  tabIndex?: number;
  title?: string;
  variant?: string;
}
/*
bg-tone-neutral
border-solid
border-2
border-tone-neutral-10
focus-visible:border-tone-neutral-09
hover:border-tone-neutral-09
p-200
px-600
text-tone-neutral-03

bg-tone-neutral border-solid border-2 border-tone-neutral-10 focus-visible:border-tone-neutral-09 hover:border-tone-neutral-09 p-200 px-600 text-tone-neutral-03
*/
const {
  href,
  class: className = '',
  tabIndex = 0,
  variant = 'none',
  title = '',
  icon = '',
} = Astro.props;

// Extract data-* attributes from props
const dataAttributes: Record<string, string> = {};
Object.keys(Astro.props).forEach((key) => {
  if (key.startsWith('data-')) {
    dataAttributes[key] = (Astro.props as any)[key];
  }
});

// Map variant names to CSS classes
const variants: Record<string, string> = {
  none: '',
  back: 'shrink-0 group hover:w-1600 focus-visible:w-1600 transition-cosmetic ease-out-expo duration-500 bg-tone-neutral button-outline hover:button-outline-strong focus-visible:button-outline-strong text-tone-neutral-03',
  next: 'shrink-0 group hover:w-1600 focus-visible:w-1600 transition-cosmetic ease-out-expo duration-500 bg-tone-neutral button-outline hover:button-outline-strong focus-visible:button-outline-strong text-tone-neutral-03',
  outline:
    'border-0 button-outline hover:button-outline-strong focus-visible:button-outline-strong',
  light:
    'text-tone-neutral-02 bg-tone-neutral border-tone-neutral hover:bg-tone-neutral-09 focus-visible:bg-tone-neutral-09',
  hero: 'text-tone-neutral bg-transparent border-transparent hover:bg-tone-neutral-01/30 focus-visible:bg-tone-neutral-01/30',
};

const variantClass = variants[variant] || '';

// Build class string: always include "button", add variant if provided, then additional classes
const buttonClasses = [
  'button first-letter:uppercase no-underline inline-flex items-center',
  variant === 'back' && 'justify-start',
  variant === 'next' && 'justify-end',
  variant === 'back' || variant === 'next'
    ? 'p-200 gap-200'
    : 'px-300 py-100 gap-200 justify-center border-2 border-solid',
  'rounded-full border-box',
  'cursor-pointer focus-bounce',
  variantClass,
  className,
]
  .filter(Boolean)
  .join(' ');

// Add target="_blank" and rel attributes only for external links (http/https)
const isExternalLink = href ? /^https?:\/\//.test(href) : false;
const linkAttrs = isExternalLink
  ? {
      target: '_blank',
      rel: 'noopener noreferrer',
    }
  : {};

const isBackOrNext = variant === 'back' || variant === 'next';
const wrapperClass =
  variant === 'back'
    ? 'inline-flex justify-self-center justify-end w-[84px]'
    : variant === 'next'
      ? 'inline-flex justify-self-center justify-start w-[84px]'
      : '';
---

{
  isBackOrNext ? (
    <div class={wrapperClass}>
      {href ? (
        <a
          class={buttonClasses}
          href={href}
          {...linkAttrs}
          {...dataAttributes}
          tabindex={tabIndex}
          title={title}
        >
          {variant === 'back' && (
            <Icon class="justify-self-start" name={icon || 'mi/outline/arrow-back'} />
          )}
          {variant === 'next' && (
            <Icon class="justify-self-end" name={icon || 'mi/outline/arrow-forward'} />
          )}
          <slot />
        </a>
      ) : (
        <button
          class={buttonClasses}
          type="button"
          {...dataAttributes}
          tabindex={tabIndex}
          title={title}
        >
          <slot />
        </button>
      )}
    </div>
  ) : (
    <>
      {href ? (
        <a
          class={buttonClasses}
          href={href}
          {...linkAttrs}
          {...dataAttributes}
          tabindex={tabIndex}
          title={title}
        >
          <slot />
        </a>
      ) : (
        <button
          class={buttonClasses}
          type="button"
          {...dataAttributes}
          tabindex={tabIndex}
          title={title}
        >
          <slot />
        </button>
      )}
    </>
  )
}
