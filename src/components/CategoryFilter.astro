---
import Button from './Button.astro';

/**
 * CategoryFilter Component
 *
 * Client-side filter buttons for filtering principles by category
 *
 * Props:
 * @param {string[]} categories - Array of category names
 * @param {string} activeCategory - Currently active category (empty string = all)
 * @param {string} class - Additional CSS classes
 */
interface Props {
  categories: string[];
  activeCategory?: string;
  class?: string;
}

const { categories, activeCategory = '', class: className = '' } = Astro.props;
---

<div class={`flex flex-wrap gap-200 ${className}`} data-filter-container>
  <Button data-filter="all" data-filter-active={String(activeCategory === '')} variant="outline">
    All
  </Button>
  {
    categories.map((category) => (
      <Button data-filter={category} data-filter-active={String(activeCategory === category)}>
        <span class="first-letter:uppercase">{category}</span>
      </Button>
    ))
  }
</div>

<script>
  function initCategoryFilter() {
    const filterContainer = document.querySelector('[data-filter-container]');
    if (!filterContainer) return;

    const filterButtons = filterContainer.querySelectorAll('[data-filter]');
    const principleCards = document.querySelectorAll('[data-principle-id]');

    filterButtons.forEach((button) => {
      button.addEventListener('click', () => {
        const filterValue = button.getAttribute('data-filter');

        // Update active state - CSS handles styling via data-filter-active attribute
        filterButtons.forEach((btn) => {
          const isActive = btn.getAttribute('data-filter') === filterValue;
          btn.setAttribute('data-filter-active', String(isActive));
        });

        // Filter cards
        principleCards.forEach((card) => {
          const cardCategory = card.getAttribute('data-category');
          const shouldShow = filterValue === 'all' || cardCategory === filterValue;

          if (shouldShow) {
            card.classList.remove('hidden');
          } else {
            card.classList.add('hidden');
          }
        });
      });
    });

    // Initialize active state - CSS handles styling via data-filter-active attribute
    // The attribute is already set in the template, so no additional initialization needed
  }

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initCategoryFilter);
  } else {
    initCategoryFilter();
  }
</script>
