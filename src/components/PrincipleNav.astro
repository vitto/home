---
import Button from './Button.astro';
import Icon from './Icon.astro';
import categoriesData from '../data/categories.json';
import designSystemsData from '../data/design-systems.json';
import userCenteredDesignData from '../data/user-centered-design.json';
import humanCenteredAiDesignData from '../data/human-centered-ai-design.json';
import Nav from './Nav.astro';
import PrincipleNavContent from './PrincipleNavContent.astro';

interface Props {
  baseUrl: string;
  currentPrincipleId: string;
  sectionPath: string;
  allPrinciples: Array<{ id: string; title: string }>;
  /** When true, show prev/next navigation arrows. Default true. */
  arrows?: boolean;
}

const { baseUrl, currentPrincipleId, sectionPath, allPrinciples, arrows = true } = Astro.props;
---

<Nav position="bottom" data-bottom-nav>
  <div
    class="pointer-events-auto w-full max-w-lg inline-flex justify-center items-center bottom-0 gap-400 p-200 nav-outline bg-tone-neutral/80 backdrop-blur rounded-full"
  >
    <PrincipleNavContent
      baseUrl={baseUrl}
      currentPrincipleId={currentPrincipleId}
      sectionPath={sectionPath}
      allPrinciples={allPrinciples}
      arrows={arrows}
    />
  </div>
</Nav>
<script>
  function initBottomNavVisibility() {
    const bottomNav = document.querySelector('[data-bottom-nav]') as HTMLElement | null;
    const targetElement = document.querySelector('.header') as HTMLElement | null;
    if (!bottomNav || !targetElement) return;

    // Set initial hidden state
    bottomNav.classList.add('translate-y-full');

    let lastScrollY = window.scrollY;
    let lastShowScrollY = window.scrollY;
    let isScrollingUp = false;
    let isHeaderIntersecting = false;
    const SCROLL_THRESHOLD = 200;

    function updateNavVisibility() {
      if (!bottomNav) return;

      const currentScrollY = window.scrollY;
      const scrollDistance = currentScrollY - lastShowScrollY;

      // Show nav when scrolling up OR when header is intersecting (prevent hiding when header is visible)
      // Hide only when scrolling down AND scroll distance >= 300px
      let shouldShow = false;

      if (isScrollingUp || isHeaderIntersecting) {
        shouldShow = true;
        lastShowScrollY = currentScrollY; // Reset threshold when showing
      } else if (!isScrollingUp && scrollDistance >= SCROLL_THRESHOLD) {
        shouldShow = false; // Hide when scrolled down more than 300px
      } else {
        shouldShow = true; // Show if scroll distance < 300px
      }

      if (shouldShow) {
        bottomNav.classList.remove('translate-y-full');
        bottomNav.classList.add('translate-y-0');
      } else {
        bottomNav.classList.add('translate-y-full');
        bottomNav.classList.remove('translate-y-0');
      }
    }

    // Track scroll direction
    window.addEventListener(
      'scroll',
      () => {
        const currentScrollY = window.scrollY;
        isScrollingUp = currentScrollY < lastScrollY;
        lastScrollY = currentScrollY;
        updateNavVisibility();
      },
      { passive: true }
    );

    const observer = new IntersectionObserver(
      ([entry]) => {
        isHeaderIntersecting = entry.isIntersecting;
        updateNavVisibility();
      },
      { threshold: 0 }
    );

    observer.observe(targetElement);
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initBottomNavVisibility);
  } else {
    initBottomNavVisibility();
  }
</script>
