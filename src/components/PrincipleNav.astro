---
import Button from './Button.astro';
import Icon from './Icon.astro';

interface Props {
  baseUrl: string;
  currentPrincipleId: string;
  sectionPath: string;
  allPrinciples: Array<{ id: string; title: string }>;
}

const { baseUrl, currentPrincipleId, sectionPath, allPrinciples } = Astro.props;

// Sort principles alphabetically by title
const sortedPrinciples = [...allPrinciples].sort((a, b) => a.title.localeCompare(b.title));

// Find current principle index in sorted array
const currentIndex = sortedPrinciples.findIndex((p) => p.id === currentPrincipleId);

// Calculate previous and next principle based on alphabetical order
const prevPrinciple = currentIndex > 0 ? sortedPrinciples[currentIndex - 1] : null;
const nextPrinciple =
  currentIndex < sortedPrinciples.length - 1 ? sortedPrinciples[currentIndex + 1] : null;

// Build URLs
const prevUrl = prevPrinciple ? `${baseUrl}${sectionPath}/${prevPrinciple.id}` : null;
const nextUrl = nextPrinciple ? `${baseUrl}${sectionPath}/${nextPrinciple.id}` : null;
---

<div class="fixed inline-flex bottom-0 left-0 right-0 justify-center pointer-events-none z-20">
  <div
    class="pointer-events-auto inline-flex justify-center items-center bottom-0 pb-200 gap-400 p-200 nav-outline-strong bg-tone-neutral/80 backdrop-blur rounded-t-[30px]"
  >
    {
      prevUrl ? (
        <Button href={prevUrl} variant="back" title="Go to previous principle" />
      ) : (
        <div class="w-[84px] shrink-0" />
      )
    }
    <a
      title="Back to top"
      href="#"
      data-scroll-to-top
      class="inline-flex focus-bounce rounded-full shrink-0 hover:rotate-[60deg] focus-visible:rotate-[60deg] ease-out-expo transition-transform duration-500 no-underline"
    >
      <Icon name="vv/logo" class="text-[40px] justify-self-center" />
    </a>
    {
      nextUrl ? (
        <Button href={nextUrl} variant="next" title="Go to next principle" />
      ) : (
        <div class="w-[84px] shrink-0" />
      )
    }
  </div>
</div>
<script>
  function initScrollToTop() {
    const scrollToTopButton = document.querySelector('[data-scroll-to-top]');
    if (!scrollToTopButton) return;

    scrollToTopButton.addEventListener('click', (e) => {
      e.preventDefault();
      window.scrollTo({
        top: 0,
        behavior: 'smooth',
      });
    });
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initScrollToTop);
  } else {
    initScrollToTop();
  }
</script>
