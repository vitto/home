---
import brandsData from '../data/brands.json';

interface Props {
  name?: string;
  url?: string;
  class?: string;
  variant?: 'shadow' | 'light';
  label?: string;
  icon?: string;
  size?: 'sm' | 'md' | 'lg';
}

const {
  name = 'none',
  icon,
  url: urlOverride,
  size = 'md',
  variant = 'light',
  label,
  class: className = '',
} = Astro.props;
const baseUrl = import.meta.env.BASE_URL;
const brandsPath = `${baseUrl}/assets/brands`;

// Find brand by id
const brand = brandsData.find((b) => b.id.toLowerCase() === name.toLowerCase());

if (!brand) {
  throw new Error(`Brand with id "${name}" not found in brands.json`);
}

// Use override url if provided, otherwise use default from JSON
const brandUrl = urlOverride || brand.url;
const logoPath = brand.logo ? `${brandsPath}/${brand.logo}` : null;

const logoSizeClass = {
  sm: 'w-auto h-400',
  md: 'w-auto h-500',
  lg: 'w-auto h-600',
}[size];

const containerSizeClass = {
  sm: 'py-150 px-300',
  md: 'py-200 px-400',
  lg: 'py-300 px-500',
}[size];

const variantClass = {
  shadow:
    'bg-tone-neutral shadow-outline-light-50 hover:shadow-outline-50 focus-visible:shadow-outline-50',
  light: 'bg-tone-neutral hover:bg-tone-neutral-09 focus-visible:bg-tone-neutral-09',
}[variant];
---

{
  brandUrl ? (
    <a
      href={brandUrl}
      target="_blank"
      rel="noreferrer noopener"
      tabindex="0"
      title={`Go to ${icon ? label + ' source' : brand.name + ' website'}`}
      class={`inline-flex shrink-0 gap-200 items-center focus-bounce justify-start rounded-full no-underline ${variantClass} ${containerSizeClass} ${className}`}
    >
      {!icon ? (
        <img src={logoPath} alt={`${brand.name} logo`} class={logoSizeClass} />
      ) : (
        <mds-icon name={icon} />
      )}
      {label && (
        <mds-text typography="caption">
          <b>{label}</b>
        </mds-text>
      )}
    </a>
  ) : (
    <div
      class={`inline-flex shrink-0 gap-200 items-center focus-bounce justify-center rounded-full ${containerSizeClass} ${className}`}
    >
      {!icon ? (
        <img src={logoPath} alt={`${brand.name} logo`} class={logoSizeClass} />
      ) : (
        <mds-icon name={icon} />
      )}
      {label && (
        <mds-text typography="caption">
          <b>{label}</b>
        </mds-text>
      )}
    </div>
  )
}
