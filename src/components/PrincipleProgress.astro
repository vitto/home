---
import categoriesData from '../data/categories.json';
import designSystemsData from '../data/design-systems.json';
import userCenteredDesignData from '../data/user-centered-design.json';
import humanCenteredAiDesignData from '../data/human-centered-ai-design.json';

interface Props {
  baseUrl: string;
  currentPrincipleId: string;
  sectionPath: string;
  allPrinciples: Array<{ id: string; title: string }>;
}

const { baseUrl, currentPrincipleId, sectionPath, allPrinciples } = Astro.props;

// Map section paths to their data
const sectionDataMap: Record<string, { principles: Array<{ id: string; title: string }> }> = {
  '/design-systems': designSystemsData,
  '/user-centered-design': userCenteredDesignData,
  '/human-centered-ai-design': humanCenteredAiDesignData,
};

// Sort principles alphabetically by title
const sortedPrinciples = [...allPrinciples].sort((a, b) => a.title.localeCompare(b.title));

// Find current principle index in sorted array
const currentIndex = sortedPrinciples.findIndex((p) => p.id === currentPrincipleId);

// Get current principle
const currentPrinciple = sortedPrinciples[currentIndex];

// Calculate page numbers (1-based) and initial percentage
const currentPage = currentIndex + 1;
const totalPages = sortedPrinciples.length;
const percentage = Math.round((currentPage / totalPages) * 100);
---

<mds-benchmark-bar
  class="w-full min-h-700 mobile:hidden"
  data-article-progress-bar
  value={percentage}
>
  {currentPrinciple?.title || 'Page title'}
</mds-benchmark-bar>
<script>
  function initArticleProgressBar() {
    const article = document.querySelector('.page-article') as HTMLElement | null;
    const bar = document.querySelector('[data-article-progress-bar]') as HTMLElement | null;
    if (!article || !bar) return;

    function getReadingProgress(): number {
      const rect = article!.getBoundingClientRect();
      const viewportH = window.innerHeight;
      const articleH = article!.offsetHeight;
      const scrollable = articleH - viewportH;
      if (scrollable <= 0) return 100;
      const progress = -rect.top / scrollable;
      return Math.round(Math.max(0, Math.min(1, progress)) * 100);
    }

    function update() {
      const percent = getReadingProgress();
      bar!.setAttribute('value', String(percent));
    }

    update();
    window.addEventListener('scroll', update, { passive: true });
    window.addEventListener('resize', update);
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initArticleProgressBar);
  } else {
    initArticleProgressBar();
  }
</script>
