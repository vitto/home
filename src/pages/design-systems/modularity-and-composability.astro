---
import PrincipleLayout from '../../layouts/PrincipleLayout.astro';
import data from '../../data/design-systems.json';
import bibliographies from '../../data/bibliographies.json';
import PrincipleNav from '../../components/PrincipleNav.astro';
import Markdown from '../../components/Markdown.astro';
import Bibliography from '../../components/Bibliography.astro';
import BibliographyItem from '../../components/BibliographyItem.astro';
import BibliographySection from '../../components/BibliographySection.astro';
import DesignComponentsWithASingleResponsibility from '../../components/use-cases/design-systems/modularity-and-composability/DesignComponentsWithASingleResponsibility.astro';
import PreferCompositionOverConfiguration from '../../components/use-cases/design-systems/modularity-and-composability/PreferCompositionOverConfiguration.astro';
import EstablishClearLayeringAndAbstractionLevels from '../../components/use-cases/design-systems/modularity-and-composability/EstablishClearLayeringAndAbstractionLevels.astro';
import DesignForReuseAcrossContexts from '../../components/use-cases/design-systems/modularity-and-composability/DesignForReuseAcrossContexts.astro';
import Article from '../../components/Article.astro';

const principle = data.principles.find((p) => p.id === 'modularity-and-composability')!;
// Get base URL from Astro config and normalize it
// Remove trailing slash if present (except for root)
const rawBaseUrl = import.meta.env.BASE_URL;
const baseUrl = rawBaseUrl === '/' ? '' : rawBaseUrl.replace(/\/$/, '');
const sectionPath = '/design-systems';
// Get bibliography items from bibliographies.json using principle.sources
const bibliography: any[] = [];
if (principle.sources && Array.isArray(principle.sources) && bibliographies) {
  principle.sources.forEach((sourceId: string) => {
    if ((bibliographies as any)[sourceId]) {
      bibliography.push((bibliographies as any)[sourceId]);
    }
  });
}
const books = bibliography?.filter((item: any) => item.type === 'book') || [];
const urls = bibliography?.filter((item: any) => item.type === 'url') || [];
const videos = bibliography?.filter((item: any) => item.type === 'video') || [];
const scientificPapers =
  bibliography?.filter((item: any) => item.type === 'scientific-paper') || [];

// Sort bibliography alphabetically by author, then by title
const sortBibliography = (items: any[]) => {
  return items.sort((a: any, b: any) => {
    const authorCompare = (a.author || '').localeCompare(b.author || '');
    if (authorCompare !== 0) return authorCompare;
    return (a.title || '').localeCompare(b.title || '');
  });
};

const sortedBooks = books.length > 0 ? sortBibliography([...books]) : [];
const sortedUrls = urls.length > 0 ? sortBibliography([...urls]) : [];
const sortedVideos = videos.length > 0 ? sortBibliography([...videos]) : [];
const sortedScientificPapers =
  scientificPapers.length > 0 ? sortBibliography([...scientificPapers]) : [];
---

<PrincipleLayout
  title={`${principle.title} - Design Systems`}
  principle={principle}
  categoryColors={data.categoryColors}
  sectionName={data.title}
  sectionPath="/design-systems"
  allPrinciples={data.principles}
>
  <Article>
    <Markdown
      content={`
Design systems scale through **composition**, not complexity.

Modularity and composability mean designing components as
small, focused units that can be combined in predictable ways.

A composable system enables teams to build diverse interfaces
without introducing inconsistency or duplication.
    `}
    />

    <DesignComponentsWithASingleResponsibility />
    <PreferCompositionOverConfiguration />
    <EstablishClearLayeringAndAbstractionLevels />
    <DesignForReuseAcrossContexts />

    <Markdown
      content={`
#### Why this principle matters

Modularity reduces cognitive load, improves reuse, and makes systems easier to evolve.

Composable design systems scale because they allow new interfaces
to emerge without rewriting existing foundations.
    `}
    />
  </Article>

  {
    bibliography && (
      <Bibliography>
        {sortedBooks.length > 0 && (
          <BibliographySection type="book">
            {sortedBooks.map((item: any) => (
              <BibliographyItem
                author={item.author}
                title={item.title}
                description={item.description}
                url={item.url}
                status={item.status}
              />
            ))}
          </BibliographySection>
        )}
        {sortedUrls.length > 0 && (
          <BibliographySection type="url">
            {sortedUrls.map((item: any) => (
              <BibliographyItem
                author={item.author}
                title={item.title}
                description={item.description}
                url={item.url}
                status={item.status}
              />
            ))}
          </BibliographySection>
        )}
        {sortedVideos.length > 0 && (
          <BibliographySection type="video">
            {sortedVideos.map((item: any) => (
              <BibliographyItem
                author={item.author}
                title={item.title}
                description={item.description}
                url={item.url}
                status={item.status}
              />
            ))}
          </BibliographySection>
        )}
        {sortedScientificPapers.length > 0 && (
          <BibliographySection type="scientific-paper">
            {sortedScientificPapers.map((item: any) => (
              <BibliographyItem
                author={item.author}
                title={item.title}
                description={item.description}
                url={item.url}
                status={item.status}
              />
            ))}
          </BibliographySection>
        )}
      </Bibliography>
    )
  }

  <!-- <PrincipleNav
    baseUrl={baseUrl}
    currentPrincipleId={principle.id}
    sectionPath={sectionPath}
    allPrinciples={data.principles}
  /> -->
</PrincipleLayout>
