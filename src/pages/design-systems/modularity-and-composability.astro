---
import PrincipleLayout from '../../layouts/PrincipleLayout.astro';
import data from '../../data/design-systems.json';
import Nav from '../../components/Nav.astro';
import SectionNav from '../../components/SectionNav.astro';
import PrincipleNav from '../../components/PrincipleNav.astro';
import Markdown from '../../components/Markdown.astro';
import Bibliography from '../../components/Bibliography.astro';
import BibliographyItem from '../../components/BibliographyItem.astro';
import BibliographySection from '../../components/BibliographySection.astro';
import DesignComponentsWithASingleResponsibility from '../../components/use-cases/design-systems/modularity-and-composability/DesignComponentsWithASingleResponsibility.astro';
import PreferCompositionOverConfiguration from '../../components/use-cases/design-systems/modularity-and-composability/PreferCompositionOverConfiguration.astro';
import EstablishClearLayeringAndAbstractionLevels from '../../components/use-cases/design-systems/modularity-and-composability/EstablishClearLayeringAndAbstractionLevels.astro';
import DesignForReuseAcrossContexts from '../../components/use-cases/design-systems/modularity-and-composability/DesignForReuseAcrossContexts.astro';
import Article from '../../components/Article.astro';

const principle = data.principles.find((p) => p.id === 'modularity-and-composability')!;
const baseUrl = import.meta.env.BASE_URL;
const sectionPath = '/design-systems';
const bibliography =
  (data.bibliography as any[])?.filter((item: any) => principle.sources?.includes(item.id)) || [];
const books = bibliography?.filter((item: any) => item.type === 'book') || [];
const urls = bibliography?.filter((item: any) => item.type === 'url') || [];

// Sort bibliography alphabetically by author, then by title
const sortBibliography = (items: any[]) => {
  return items.sort((a: any, b: any) => {
    const authorCompare = (a.author || '').localeCompare(b.author || '');
    if (authorCompare !== 0) return authorCompare;
    return (a.title || '').localeCompare(b.title || '');
  });
};

const sortedBooks = books.length > 0 ? sortBibliography([...books]) : [];
const sortedUrls = urls.length > 0 ? sortBibliography([...urls]) : [];
---

<PrincipleLayout
  title={`${principle.title} - Design Systems`}
  principle={principle}
  categoryColors={data.categoryColors}
  sectionName={data.title}
  sectionPath="/design-systems"
>
  <Article>
    <Markdown
      content={`
Design systems scale through **composition**, not complexity.

Modularity and composability mean designing components as
small, focused units that can be combined in predictable ways.

A composable system enables teams to build diverse interfaces
without introducing inconsistency or duplication.
    `}
    />

    <DesignComponentsWithASingleResponsibility />
    <PreferCompositionOverConfiguration />
    <EstablishClearLayeringAndAbstractionLevels />
    <DesignForReuseAcrossContexts />

    <Markdown
      content={`
#### Why this principle matters

Modularity reduces cognitive load, improves reuse, and makes systems easier to evolve.

Composable design systems scale because they allow new interfaces
to emerge without rewriting existing foundations.
    `}
    />
  </Article>

  {
    bibliography && (
      <Bibliography>
        {sortedBooks.length > 0 && (
          <BibliographySection type="books">
            {sortedBooks.map((item: any) => (
              <BibliographyItem
                author={item.author}
                title={item.title}
                description={item.description}
                url={item.url}
                status={item.status}
              />
            ))}
          </BibliographySection>
        )}
        {sortedUrls.length > 0 && (
          <BibliographySection type="urls">
            {sortedUrls.map((item: any) => (
              <BibliographyItem
                author={item.author}
                title={item.title}
                description={item.description}
                url={item.url}
                status={item.status}
              />
            ))}
          </BibliographySection>
        )}
      </Bibliography>
    )
  }

  <Nav>
    <SectionNav baseUrl={baseUrl} sectionPath={sectionPath} />
    <PrincipleNav
      baseUrl={baseUrl}
      currentPrincipleId={principle.id}
      sectionPath={sectionPath}
      allPrinciples={data.principles}
    />
  </Nav>
</PrincipleLayout>
