---
import PrincipleLayout from '../../layouts/PrincipleLayout.astro';
import data from '../../data/design-systems.json';
import Nav from '../../components/Nav.astro';
import SectionNav from '../../components/SectionNav.astro';
import PrincipleNav from '../../components/PrincipleNav.astro';
import Markdown from '../../components/Markdown.astro';
import Usage from '../../components/Usage.astro';
import UsageItem from '../../components/UsageItem.astro';
import Bibliography from '../../components/Bibliography.astro';
import BibliographyItem from '../../components/BibliographyItem.astro';
import BibliographySection from '../../components/BibliographySection.astro';
import CollectFeedbackSystematically from '../../components/use-cases/design-systems/feedback-driven-improvement/CollectFeedbackSystematically.astro';
import MeasureActualUsage from '../../components/use-cases/design-systems/feedback-driven-improvement/MeasureActualUsage.astro';
import ActOnFeedbackVisibly from '../../components/use-cases/design-systems/feedback-driven-improvement/ActOnFeedbackVisibly.astro';
import PrioritizeBasedOnImpact from '../../components/use-cases/design-systems/feedback-driven-improvement/PrioritizeBasedOnImpact.astro';
import CloseTheFeedbackLoop from '../../components/use-cases/design-systems/feedback-driven-improvement/CloseTheFeedbackLoop.astro';
import Article from '../../components/Article.astro';

const principle = data.principles.find((p) => p.id === 'feedback-driven-improvement')!;
const baseUrl = import.meta.env.BASE_URL;
const sectionPath = '/design-systems';
const bibliography =
  (data.bibliography as any[])?.filter((item: any) => principle.sources?.includes(item.id)) || [];
const books = bibliography?.filter((item: any) => item.type === 'book') || [];
const urls = bibliography?.filter((item: any) => item.type === 'url') || [];

// Sort bibliography alphabetically by author, then by title
const sortBibliography = (items: any[]) => {
  return items.sort((a: any, b: any) => {
    const authorCompare = (a.author || '').localeCompare(b.author || '');
    if (authorCompare !== 0) return authorCompare;
    return (a.title || '').localeCompare(b.title || '');
  });
};

const sortedBooks = books.length > 0 ? sortBibliography([...books]) : [];
const sortedUrls = urls.length > 0 ? sortBibliography([...urls]) : [];
---

<PrincipleLayout
  title={`${principle.title} - Design Systems`}
  principle={principle}
  categoryColors={data.categoryColors}
  sectionName={data.title}
  sectionPath="/design-systems"
>
  <Article>
    <Markdown
      content={`
A design system that doesn't respond to feedback becomes disconnected from reality.

Feedback-driven improvement means the system evolves based on:

- how teams actually use it,
- what problems they encounter,
- and what they need to build better products.

Without feedback loops, the system team operates in isolation,
making assumptions that may not match real-world needs.
      `}
    />

    <CollectFeedbackSystematically />
    <MeasureActualUsage />
    <ActOnFeedbackVisibly />
    <PrioritizeBasedOnImpact />
    <CloseTheFeedbackLoop />

    <Markdown
      content={`
#### Why this principle matters

Feedback-driven improvement keeps the design system relevant and useful.

When teams see their input leads to real changes,
they become more invested in the system and more likely to contribute.

Systems that ignore feedback become disconnected from user needs
and eventually lose adoption and trust.
      `}
    />
  </Article>

  {
    bibliography && (
      <Bibliography>
        {sortedBooks.length > 0 && (
          <BibliographySection type="book">
            {sortedBooks.map((item: any) => (
              <BibliographyItem
                author={item.author}
                title={item.title}
                description={item.description}
                url={item.url}
                status={item.status}
              />
            ))}
          </BibliographySection>
        )}
        {sortedUrls.length > 0 && (
          <BibliographySection type="url">
            {sortedUrls.map((item: any) => (
              <BibliographyItem
                author={item.author}
                title={item.title}
                description={item.description}
                url={item.url}
                status={item.status}
              />
            ))}
          </BibliographySection>
        )}
      </Bibliography>
    )
  }

  <Nav>
    <SectionNav baseUrl={baseUrl} sectionPath={sectionPath} />
    <PrincipleNav
      baseUrl={baseUrl}
      currentPrincipleId={principle.id}
      sectionPath={sectionPath}
      allPrinciples={data.principles}
    />
  </Nav>
</PrincipleLayout>
