---
import PrincipleLayout from '../../layouts/PrincipleLayout.astro';
import data from '../../data/design-systems.json';
import bibliographies from '../../data/bibliographies.json';
import Nav from '../../components/Nav.astro';
import SectionNav from '../../components/SectionNav.astro';
import PrincipleNav from '../../components/PrincipleNav.astro';
import Markdown from '../../components/Markdown.astro';
import Bibliography from '../../components/Bibliography.astro';
import BibliographyItem from '../../components/BibliographyItem.astro';
import BibliographySection from '../../components/BibliographySection.astro';
import LimitedAndIntentionalComponentApis from '../../components/use-cases/design-systems/constraints-driven-design/LimitedAndIntentionalComponentApis.astro';
import DesignTokensAsEnforcedBoundaries from '../../components/use-cases/design-systems/constraints-driven-design/DesignTokensAsEnforcedBoundaries.astro';
import CompositionRulesInsteadOfFreeAssembly from '../../components/use-cases/design-systems/constraints-driven-design/CompositionRulesInsteadOfFreeAssembly.astro';
import AccessibilityConstraintsAsNonNegotiable from '../../components/use-cases/design-systems/constraints-driven-design/AccessibilityConstraintsAsNonNegotiable.astro';
import SystemLevelDefaultsOverLocalOverrides from '../../components/use-cases/design-systems/constraints-driven-design/SystemLevelDefaultsOverLocalOverrides.astro';
import ExplicitOutOfScopeDecisions from '../../components/use-cases/design-systems/constraints-driven-design/ExplicitOutOfScopeDecisions.astro';
import Article from '../../components/Article.astro';

const principle = data.principles.find((p) => p.id === 'constraints-driven-design')!;
// Get base URL from Astro config and normalize it
// Remove trailing slash if present (except for root)
const rawBaseUrl = import.meta.env.BASE_URL;
const baseUrl = rawBaseUrl === '/' ? '' : rawBaseUrl.replace(/\/$/, '');
const sectionPath = '/design-systems';
// Get bibliography items from bibliographies.json using principle.sources
const bibliography: any[] = [];
if (principle.sources && Array.isArray(principle.sources) && bibliographies) {
  principle.sources.forEach((sourceId: string) => {
    if ((bibliographies as any)[sourceId]) {
      bibliography.push((bibliographies as any)[sourceId]);
    }
  });
}
const books = bibliography?.filter((item: any) => item.type === 'book') || [];
const urls = bibliography?.filter((item: any) => item.type === 'url') || [];
const videos = bibliography?.filter((item: any) => item.type === 'video') || [];

// Sort bibliography alphabetically by author, then by title
const sortBibliography = (items: any[]) => {
  return items.sort((a: any, b: any) => {
    const authorCompare = (a.author || '').localeCompare(b.author || '');
    if (authorCompare !== 0) return authorCompare;
    return (a.title || '').localeCompare(b.title || '');
  });
};

const sortedBooks = books.length > 0 ? sortBibliography([...books]) : [];
const sortedUrls = urls.length > 0 ? sortBibliography([...urls]) : [];
const sortedVideos = videos.length > 0 ? sortBibliography([...videos]) : [];
---

<PrincipleLayout
  title={`${principle.title} - Design Systems`}
  principle={principle}
  categoryColors={data.categoryColors}
  sectionName={data.title}
  sectionPath="/design-systems"
>
  <Article>
    <Markdown
      content={`
When I design a design system, I treat constraints as a design tool, not as a limitation to work around.

Explicit constraints reduce ambiguity, guide decision-making, and prevent the gradual erosion of the system.

In the absence of clearly defined constraints, teams tend to:

- improvise solutions,
- stretch components beyond their intended purpose,
- and introduce inconsistencies that are difficult to detect and even harder to remove.

A constraints-driven system makes boundaries visible.

It defines not only what is possible, but also what is intentionally unsupported, allowing teams to move faster and with greater confidence.

- Constraints are most effective when they are:
- explicit,
- documented,
- and enforced by the system itself.
      `}
    />

    <LimitedAndIntentionalComponentApis />
    <DesignTokensAsEnforcedBoundaries />
    <CompositionRulesInsteadOfFreeAssembly />
    <AccessibilityConstraintsAsNonNegotiable />
    <SystemLevelDefaultsOverLocalOverrides />
    <ExplicitOutOfScopeDecisions />

    <Markdown
      content={`
#### Why this principle matters

Constraints are what make systems scalable and trustworthy.

They reduce cognitive load, prevent entropy, and make correct usage the easiest path.

A design system without constraints is not flexible, it is fragile.

By designing constraints intentionally, the system enables creativity within safe and predictable boundaries.
  `}
    />
  </Article>

  {
    bibliography && (
      <Bibliography>
        {sortedBooks.length > 0 && (
          <BibliographySection type="book">
            {sortedBooks.map((item: any) => (
              <BibliographyItem
                author={item.author}
                title={item.title}
                description={item.description}
                url={item.url}
                status={item.status}
              />
            ))}
          </BibliographySection>
        )}
        {sortedUrls.length > 0 && (
          <BibliographySection type="url">
            {sortedUrls.map((item: any) => (
              <BibliographyItem
                author={item.author}
                title={item.title}
                description={item.description}
                url={item.url}
                status={item.status}
              />
            ))}
          </BibliographySection>
        )}
        {sortedVideos.length > 0 && (
          <BibliographySection type="video">
            {sortedVideos.map((item: any) => (
              <BibliographyItem
                author={item.author}
                title={item.title}
                description={item.description}
                url={item.url}
                status={item.status}
              />
            ))}
          </BibliographySection>
        )}
      </Bibliography>
    )
  }

  <Nav>
    <SectionNav baseUrl={baseUrl} sectionPath={sectionPath} />
    <PrincipleNav
      baseUrl={baseUrl}
      currentPrincipleId={principle.id}
      sectionPath={sectionPath}
      allPrinciples={data.principles}
    />
  </Nav>
</PrincipleLayout>
