---
import PrincipleLayout from '../../layouts/PrincipleLayout.astro';
import data from '../../data/user-centered-design.json';
import UseCase from '../../components/UseCase.astro';
import UseCaseInteractive from '../../components/UseCaseInteractive.astro';

const principle = data.principles.find((p) => p.id === 'visibility-of-system-status')!;
---

<PrincipleLayout
  title={`${principle.title} - Design Systems`}
  principle={principle}
  categoryColors={data.categoryColors}
  sectionName={data.title}
  sectionPath="/design-systems"
>
  <UseCase
    title="Loading / Waiting"
    description="The system makes it clear that an operation is in progress and, when possible, communicates its duration or progress, reducing anxiety and uncertainty during the wait."
  >
    <UseCaseInteractive>
      <mds-benchmark-bar
        class="min-h-[28px] max-w-8000 w-full"
        value="0"
        max="100"
        variant="primary"
        alias="Ready"
        data-progress-bar
      >
        <span data-progress-text>Ready to save data</span>
      </mds-benchmark-bar>
      <mds-button class="max-w-8000 w-full" data-save-button>Proceed</mds-button>
      <script>
        function initSaveDataDemo() {
          // Get the UseCase scope (article and container) for this script
          // Can pass id explicitly or let it find automatically
          const scope = (window as any).getUseCaseScope?.('loading-waiting');
          if (!scope) return;

          const { container } = scope;

          // Scope all queries to the container
          const saveButton = container.querySelector('[data-save-button]');
          const progressBar = container.querySelector('[data-progress-bar]');
          const progressText = container.querySelector('[data-progress-text]');

          if (!saveButton || !progressBar || !progressText) return;

          const progressStates = [
            { value: 0, alias: 'Ready', text: 'Ready to save data' },
            { value: 20, alias: 'Files', text: 'Saving' },
            { value: 40, alias: 'Images', text: 'Saving' },
            { value: 60, alias: 'Metadata', text: 'Saving' },
            { value: 80, alias: 'Personal data', text: 'Saving' },
            { value: 100, alias: 'Complete', text: 'Saving' },
          ];

          let isSaving = false;
          let currentStateIndex = 0;

          const resetDemo = () => {
            isSaving = false;
            currentStateIndex = 0;
            saveButton.removeAttribute('await');
            saveButton.removeAttribute('icon');
            saveButton.setAttribute('variant', 'primary');
            saveButton.textContent = 'Proceed';
            progressBar.setAttribute('value', '0');
            progressBar.setAttribute('alias', 'Ready');
            progressText.textContent = 'Ready to save data';
          };

          const updateProgress = () => {
            const state = progressStates[currentStateIndex];
            progressBar.setAttribute('value', String(state.value));
            progressBar.setAttribute('alias', state.alias);
            progressText.textContent = state.text;

            // Update button when reaching 100%
            if (state.value === 100) {
              saveButton.textContent = 'Complete';
              saveButton.setAttribute('icon', 'mi/baseline/done');
              saveButton.removeAttribute('await');
              saveButton.setAttribute('variant', 'success');
            }

            currentStateIndex++;

            if (currentStateIndex < progressStates.length) {
              // Random delay between 600-1000ms for each step
              const randomDelay = Math.floor(Math.random() * (1000 - 600 + 1)) + 600;
              setTimeout(updateProgress, randomDelay);
            } else {
              // Wait 1 second at 100% before resetting
              setTimeout(() => {
                resetDemo();
              }, 2000);
            }
          };

          saveButton.addEventListener('click', () => {
            if (isSaving) return;

            isSaving = true;
            saveButton.setAttribute('await', 'true');
            saveButton.textContent = 'Please wait...';
            currentStateIndex = 1; // Start from first progress state
            updateProgress();
          });
        }

        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initSaveDataDemo);
        } else {
          initSaveDataDemo();
        }
      </script>
    </UseCaseInteractive>
  </UseCase>

  <UseCase
    title="User Actions"
    description="Every input produces immediate and perceptible feedback, so the user knows the action has been received and is being processed or completed."
  >
    <UseCaseInteractive>
      <mds-button class="max-w-8000 w-full" data-save-button>Save</mds-button>
      <script>
        function initSaveButton() {
          // Get the UseCase scope (article and container) for this script
          const scope = (window as any).getUseCaseScope?.('user-actions');
          if (!scope) return;

          const { container } = scope;

          // Scope query to the container
          const saveButton = container.querySelector('[data-save-button]');
          if (!saveButton) return;

          saveButton.addEventListener('click', () => {
            saveButton.textContent = 'Element saved successfully';
            saveButton.setAttribute('disabled', 'true');
            saveButton.setAttribute('icon', 'mi/baseline/done');
            saveButton.setAttribute('variant', 'success');
            setTimeout(() => {
              saveButton.textContent = 'Save';
              saveButton.removeAttribute('disabled');
              saveButton.removeAttribute('icon');
              saveButton.setAttribute('variant', 'primary');
            }, 2000);
          });
        }

        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initSaveButton);
        } else {
          initSaveButton();
        }
      </script>
    </UseCaseInteractive>
  </UseCase>

  <UseCase
    title="Background Processes"
    description="Activities that are not immediately active remain visible in the system state, preventing the user from losing context or repeating actions already initiated."
  >
    <UseCaseInteractive>
      <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Quisquam, quos.</p>
    </UseCaseInteractive>
  </UseCase>

  <UseCase
    title="Errors and Problems"
    description="The system promptly reports anomalies and crashes, explaining what is happening and whether any action is required."
  >
    <UseCaseInteractive>
      <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Quisquam, quos.</p>
    </UseCaseInteractive>
  </UseCase>

  <UseCase
    title="Navigation and Flows"
    description="The interface clearly communicates the current position and progress within a path, preventing disorientation and abandonment."
  >
    <UseCaseInteractive>
      <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Quisquam, quos.</p>
    </UseCaseInteractive>
  </UseCase>

  <UseCase
    title="Input and Validation"
    description="The status of the data entered is always clear, allowing the user to immediately know whether what they are doing is correct or requires correction."
  >
    <UseCaseInteractive>
      <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Quisquam, quos.</p>
    </UseCaseInteractive>
  </UseCase>

  <UseCase
    title="System and Settings"
    description="Configurations instantly reflect their actual state, so the user never has to guess whether a change has been applied or not."
  >
    <UseCaseInteractive>
      <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Quisquam, quos.</p>
    </UseCaseInteractive>
  </UseCase>
</PrincipleLayout>
