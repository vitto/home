---
import PrincipleLayout from '../../layouts/PrincipleLayout.astro';
import data from '../../data/user-centered-design.json';
import LoadingWaiting from '../../components/use-cases/user-centered-design/visibility-of-system-status/LoadingWaiting.astro';
import UserActions from '../../components/use-cases/user-centered-design/visibility-of-system-status/UserActions.astro';
import BackgroundProcesses from '../../components/use-cases/user-centered-design/visibility-of-system-status/BackgroundProcesses.astro';
import ErrorsAndProblems from '../../components/use-cases/user-centered-design/visibility-of-system-status/ErrorsAndProblems.astro';
import NavigationAndFlows from '../../components/use-cases/user-centered-design/visibility-of-system-status/NavigationAndFlows.astro';
import InputAndValidation from '../../components/use-cases/user-centered-design/visibility-of-system-status/InputAndValidation.astro';
import SystemAndSettings from '../../components/use-cases/user-centered-design/visibility-of-system-status/SystemAndSettings.astro';
import Nav from '../../components/Nav.astro';
import SectionNav from '../../components/SectionNav.astro';
import PrincipleNav from '../../components/PrincipleNav.astro';
import Bibliography from '../../components/Bibliography.astro';
import BibliographyItem from '../../components/BibliographyItem.astro';
import BibliographySection from '../../components/BibliographySection.astro';

const principle = data.principles.find((p) => p.id === 'visibility-of-system-status')!;
const baseUrl = import.meta.env.BASE_URL;
const sectionPath = '/user-centered-design';
const bibliography =
  (data.bibliography as any[])?.filter((item: any) => principle.sources?.includes(item.id)) || [];
const books = bibliography?.filter((item: any) => item.type === 'book') || [];
const urls = bibliography?.filter((item: any) => item.type === 'url') || [];

// Sort bibliography alphabetically by author, then by title
const sortBibliography = (items: any[]) => {
  return items.sort((a: any, b: any) => {
    const authorCompare = (a.author || '').localeCompare(b.author || '');
    if (authorCompare !== 0) return authorCompare;
    return (a.title || '').localeCompare(b.title || '');
  });
};

const sortedBooks = books.length > 0 ? sortBibliography([...books]) : [];
const sortedUrls = urls.length > 0 ? sortBibliography([...urls]) : [];

const sectionName = 'User-Centered Design';
---

<PrincipleLayout
  title={`${principle.title} / ${sectionName}`}
  principle={principle}
  categoryColors={data.categoryColors}
  sectionName={data.title}
  sectionPath={sectionPath}
>
  <BackgroundProcesses />
  <ErrorsAndProblems />
  <InputAndValidation />
  <LoadingWaiting />
  <NavigationAndFlows />
  <SystemAndSettings />
  <UserActions />
  {
    bibliography && (
      <Bibliography>
        {sortedBooks.length > 0 && (
          <BibliographySection type="book">
            {sortedBooks.map((item: any) => (
              <BibliographyItem
                author={item.author}
                title={item.title}
                description={item.description}
                url={item.url}
                status={item.status}
              />
            ))}
          </BibliographySection>
        )}
        {sortedUrls.length > 0 && (
          <BibliographySection type="url">
            {sortedUrls.map((item: any) => (
              <BibliographyItem
                author={item.author}
                title={item.title}
                description={item.description}
                url={item.url}
                status={item.status}
              />
            ))}
          </BibliographySection>
        )}
      </Bibliography>
    )
  }

  <Nav>
    <SectionNav baseUrl={baseUrl} sectionPath={sectionPath} />
    <PrincipleNav
      baseUrl={baseUrl}
      currentPrincipleId={principle.id}
      sectionPath={sectionPath}
      allPrinciples={data.principles}
    />
  </Nav>
</PrincipleLayout>
