---
import PrincipleLayout from '../../layouts/PrincipleLayout.astro';
import data from '../../data/human-centered-ai-design.json';
import bibliographies from '../../data/bibliographies.json';
import PrincipleNav from '../../components/PrincipleNav.astro';
import Markdown from '../../components/Markdown.astro';
import Bibliography from '../../components/Bibliography.astro';
import BibliographyItem from '../../components/BibliographyItem.astro';
import BibliographySection from '../../components/BibliographySection.astro';
import Article from '../../components/Article.astro';
import ExplicitUserChoiceAndConsent from '../../components/use-cases/human-centered-ai-design/preserve-user-agency/ExplicitUserChoiceAndConsent.astro';
import UserOverrideAndManualControl from '../../components/use-cases/human-centered-ai-design/preserve-user-agency/UserOverrideAndManualControl.astro';
import ReversibilityAndUndo from '../../components/use-cases/human-centered-ai-design/preserve-user-agency/ReversibilityAndUndo.astro';
import ConfigurableAutonomyLevels from '../../components/use-cases/human-centered-ai-design/preserve-user-agency/ConfigurableAutonomyLevels.astro';
import ClearResponsibilityBoundaries from '../../components/use-cases/human-centered-ai-design/preserve-user-agency/ClearResponsibilityBoundaries.astro';

const principle = data.principles.find((p) => p.id === 'preserve-user-agency')!;
// Get base URL from Astro config and normalize it
// Remove trailing slash if present (except for root)
const rawBaseUrl = import.meta.env.BASE_URL;
const baseUrl = rawBaseUrl === '/' ? '' : rawBaseUrl.replace(/\/$/, '');
const sectionPath = '/human-centered-ai-design';
// Get bibliography items from bibliographies.json using principle.sources
const bibliography: any[] = [];
if (principle.sources && Array.isArray(principle.sources) && bibliographies) {
  principle.sources.forEach((sourceId: string) => {
    if ((bibliographies as any)[sourceId]) {
      bibliography.push((bibliographies as any)[sourceId]);
    }
  });
}
const books = bibliography?.filter((item: any) => item.type === 'book') || [];
const urls = bibliography?.filter((item: any) => item.type === 'url') || [];
const videos = bibliography?.filter((item: any) => item.type === 'video') || [];
const scientificPapers =
  bibliography?.filter((item: any) => item.type === 'scientific-paper') || [];

// Sort bibliography alphabetically by author, then by title
const sortBibliography = (items: any[]) => {
  return items.sort((a: any, b: any) => {
    const authorCompare = (a.author || '').localeCompare(b.author || '');
    if (authorCompare !== 0) return authorCompare;
    return (a.title || '').localeCompare(b.title || '');
  });
};

const sortedBooks = books.length > 0 ? sortBibliography([...books]) : [];
const sortedUrls = urls.length > 0 ? sortBibliography([...urls]) : [];
const sortedVideos = videos.length > 0 ? sortBibliography([...videos]) : [];
const sortedScientificPapers =
  scientificPapers.length > 0 ? sortBibliography([...scientificPapers]) : [];
---

<PrincipleLayout
  title={`${principle.title} - Human-Centered AI Design`}
  principle={principle}
  categoryColors={data.categoryColors}
  sectionName={data.title}
  sectionPath="/human-centered-ai-design"
>
  <Article>
    <Markdown
      content={`
Users must remain the final decision-makers in AI-powered systems. AI should support and augment human judgment, not replace it or make decisions on behalf of users without their explicit consent.

When I design AI-powered experiences, I **preserve user agency** by ensuring users always have control over AI actions and remain responsible for final decisions.

Preserving user agency means:
- **Explicit consent:** Users choose when AI acts, not the other way around
- **Override capability:** Users can always modify or reject AI suggestions
- **Reversibility:** Users can undo AI actions and return to previous states
- **Configurable autonomy:** Users control how much the AI can do automatically
- **Clear boundaries:** Users understand where their responsibility begins and AI support ends

AI systems that remove user agency create several problems:
- users lose control over important decisions,
- they can't correct mistakes or adjust AI behavior,
- and they may be held responsible for decisions they didn't actually make.

By preserving user agency, I help users:
- maintain control over their workflows and decisions,
- trust the system because they know they can override it,
- and take appropriate responsibility for outcomes.
      `}
    />

    <ExplicitUserChoiceAndConsent />
    <UserOverrideAndManualControl />
    <ReversibilityAndUndo />
    <ConfigurableAutonomyLevels />
    <ClearResponsibilityBoundaries />

    <Markdown
      content={`
#### Why this principle matters

User agency is fundamental to ethical AI design. When users lose control over AI systems, they lose the ability to make informed decisions and take appropriate responsibility.

When user agency is preserved:
- users can make decisions aligned with their values and goals,
- they can correct AI mistakes and adjust system behavior,
- and they maintain appropriate control over their workflows.

Without preserved user agency, users may:
- be forced to accept AI decisions they disagree with,
- lose the ability to correct errors or override inappropriate actions,
- or be held responsible for decisions they didn't actually make.
      `}
    />
  </Article>

  {
    bibliography && (
      <Bibliography>
        {sortedBooks.length > 0 && (
          <BibliographySection type="book">
            {sortedBooks.map((item: any) => (
              <BibliographyItem
                author={item.author}
                title={item.title}
                description={item.description}
                url={item.url}
                status={item.status}
              />
            ))}
          </BibliographySection>
        )}
        {sortedUrls.length > 0 && (
          <BibliographySection type="url">
            {sortedUrls.map((item: any) => (
              <BibliographyItem
                author={item.author}
                title={item.title}
                description={item.description}
                url={item.url}
                status={item.status}
              />
            ))}
          </BibliographySection>
        )}
        {sortedVideos.length > 0 && (
          <BibliographySection type="video">
            {sortedVideos.map((item: any) => (
              <BibliographyItem
                author={item.author}
                title={item.title}
                description={item.description}
                url={item.url}
                status={item.status}
              />
            ))}
          </BibliographySection>
        )}
        {sortedScientificPapers.length > 0 && (
          <BibliographySection type="scientific-paper">
            {sortedScientificPapers.map((item: any) => (
              <BibliographyItem
                author={item.author}
                title={item.title}
                description={item.description}
                url={item.url}
                status={item.status}
              />
            ))}
          </BibliographySection>
        )}
      </Bibliography>
    )
  }

  <PrincipleNav
    baseUrl={baseUrl}
    currentPrincipleId={principle.id}
    sectionPath={sectionPath}
    allPrinciples={data.principles}
  />
</PrincipleLayout>
